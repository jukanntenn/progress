# Internationalization (i18n)

## Overview

- Uses GNU gettext (not Babel)
- Translation files located in `src/progress/locales/`
- Compiled `.mo` files excluded from git (see `.gitignore`)
- Docker image compiles translations during build

## Usage

### Python Code

```python
from progress.i18n import gettext as _

message = _("Translatable string")
```

### Jinja2 Templates

```jinja2
{{ _("Translatable string") }}
```

## Initialization

Translation system is automatically initialized at application startup (in `cli.py`).

For external module usage, initialize first:

```python
from progress.i18n import initialize
initialize(ui_language="en")
```

## Thread Safety

Translation system uses thread-local storage to ensure safety in concurrent environments.

## Adding New Translations

### 1. Mark Strings for Translation

In Python code:

```python
from progress.i18n import gettext as _

message = _("Translatable string")
```

In Jinja2 templates:

```jinja2
{{ _("Translatable string") }}
```

### 2. Extract Translatable Strings

```bash
./scripts/makemessages.sh
```

This creates/updates `src/progress/locales/progress.pot`

### 3. Add / Update New Language

For adding:

```bash
mkdir -p src/progress/locales/<lang>/LC_MESSAGES
msginit --locale=<lang> --input=src/progress/locales/progress.pot \
    --output=src/progress/locales/<lang>/LC_MESSAGES/progress.po
```

For updating:

```bash
msgmerge --update \
    src/progress/locales/<lang>/LC_MESSAGES/progress.po \
    src/progress/locales/progress.pot
```

### 4. Edit Translation File

```bash
vim src/progress/locales/<lang>/LC_MESSAGES/progress.po
```

Fill in `msgstr` values for each `msgid`

### 5. Compile Translations

```bash
./scripts/compilemessages.sh
```

This generates `.mo` files (binary format) for runtime use

## Configuration

Set language in `config.toml`:

```toml
language = "en"  # or "zh-hans", etc.
```

## Git Ignore

The following files are excluded from version control:

- `*.mo` - Compiled translation files
- `**/*.po~` - Editor backup files

## File Structure

```
src/progress/
├── i18n.py                    # gettext utilities
├── locales/
│   ├── progress.pot           # Translation template
│   └── <lang>/
│       └── LC_MESSAGES/
│           ├── progress.po    # Translation source
│           └── progress.mo    # Compiled (not in git)
scripts/
├── makemessages.sh            # Extract strings
└── compilemessages.sh         # Compile translations
```

## Language Codes

- `en` - English (default)
- `zh-hans` - Chinese (Simplified)

Use standard IANA language codes or locale variants (e.g., `zh-hans`, `zh-Hans`).
