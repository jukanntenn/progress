# Contrib 模块功能说明

Contrib 模块是一个可扩展的追踪系统，包含三个独立的核心组件，用于监控不同类型的变化并生成通知。

## Changelog 组件 - 更新日志追踪

**功能**：监控外部项目或产品的版本发布页面，检测新版本发布。

**工作流程**：
1. **同步配置**：将用户配置的 changelog URL 同步到数据库
2. **首次检查**：解析 changelog 页面，提取最新版本的版本号和更新内容，记录到数据库，生成报告并发送通知
3. **增量检查**：重新解析页面，与上次记录的版本对比：
   - 有新版本 → 提取新版本的更新内容，生成报告并发送通知
   - 无新版本 → 仅更新检查时间
4. **结果状态**：`success`（有新版本）、`no_new_version`（无变化）、`failed`（解析失败）、`skipped`（已禁用）

**支持格式**：Markdown 格式的 CHANGELOG、部分中文 HTML 页面

## Proposal 组件 - 提案追踪

**功能**：追踪开源项目提案/规范文档的状态变化，支持 EIP（以太坊）、PEP（Python）、Rust RFC、Django DEP 等类型

**工作流程**：
1. **同步配置**：将用户配置的提案仓库信息同步到数据库
2. **首次检查**：
   - 克隆提案仓库
   - 遍历匹配的提案文件，解析并存入数据库
   - 选取最新创建的一个提案进行分析，生成报告并发送通知
3. **增量检查**：
   - 拉取最新代码，对比 commit 变化
   - 对变更的提案文件进行解析，检测事件类型：
     - **新提案**：首次出现的提案
     - **状态变更**：status 字段变化（如 Draft → Final、Rejected、Withdrawn 等）
     - **内容修改**：提案内容有改动但状态不变
     - **删除**：提案文件被删除（可能标记为 Withdrawn）
   - 对检测到的事件进行 AI 分析，生成报告并发送通知
4. **并发支持**：可配置多线程并发检查多个仓库

## Repo 组件 - 仓库追踪

**功能**：追踪 GitHub 仓库的代码变更和 Release 发布，生成 AI 分析报告。

### RepositoryManager - 仓库检查

**工作流程**：
1. **同步配置**：将用户配置的仓库列表同步到数据库
2. **首次检查**：
   - 克隆仓库
   - 获取最近 N 个 commit 的 diff（可配置回溯数量）
   - 获取最近的 Release 信息
   - AI 分析代码变更和 Release 内容
   - 生成报告并发送通知
3. **增量检查**：
   - 拉取最新代码
   - 获取自上次检查后的 commit diff
   - 获取自上次检查后发布的新 Release
   - AI 分析并生成报告
4. **报告生成**：使用 Jinja2 模板生成 Markdown 格式的聚合报告

### OwnerManager - 新仓库发现

**功能**：监控指定的 GitHub 用户/组织，自动发现其新创建的仓库。

**工作流程**：
1. **同步配置**：将用户配置的 GitHub Owner（用户或组织）同步到数据库
2. **检查**：
   - 调用 GitHub API 获取 Owner 的仓库列表
   - 对比上次记录的仓库创建时间，筛选出新创建的仓库
   - 获取新仓库的 README 内容
   - 记录到数据库，生成报告并发送通知
3. **追踪状态**：记录已发现的最新仓库创建时间，下次检查时只返回比该时间更新的仓库

## 总结对比

| 组件 | 追踪对象 | 触发条件 | 通知内容 |
|------|----------|----------|----------|
| **Changelog** | 外部产品的更新日志页面 | 版本号变化 | 新版本的更新说明 |
| **Proposal** | 提案仓库中的文档文件 | 文件变更/状态变化 | 提案状态变更说明 |
| **Repo** | GitHub 仓库 | commit/release | 代码变更分析 |
| **Owner** | GitHub 用户/组织 | 新仓库创建 | 新仓库基本信息 |
